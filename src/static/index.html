<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Consiglio</title>
    <style>
      body { font-family: system-ui, sans-serif; margin: 24px; max-width: 900px; }
      .row { display: flex; gap: 12px; margin: 8px 0; }
      textarea { width: 100%; height: 100px; }
      pre { background: #0f172a; color: #e2e8f0; padding: 12px; border-radius: 6px; overflow:auto; }
      .col { flex: 1; }
      img { max-width: 100%; border: 1px solid #ddd; border-radius: 6px; }
      .section { margin: 24px 0; }
      .item { padding: 4px 0; border-bottom: 1px dashed #ddd; }
    </style>
  </head>
  <body>
    <h1>Consiglio Web</h1>
    <div class="section">
      <h2>Chat</h2>
      <div class="row">
        <textarea id="chat-input" placeholder="Ask something..."></textarea>
      </div>
      <button id="chat-send">Send</button>
      <div class="row">
        <pre id="chat-output"></pre>
      </div>
    </div>

    <div class="section">
      <h2>Image Generation</h2>
      <div class="row">
        <input id="img-prompt" placeholder="A futuristic city at dusk..." style="flex:1" />
        <button id="img-gen">Generate</button>
      </div>
      <div id="img-output"></div>
    </div>

    <div class="section">
      <h2>RAG</h2>
      <div class="row">
        <input id="corpus" placeholder="corpus name" value="default" />
        <input id="file-path" placeholder="/workspace/data/vegeta-data.json" class="col" />
        <button id="ingest">Ingest File</button>
      </div>
      <div class="row">
        <input id="query" placeholder="Search query" class="col" />
        <button id="search">Search</button>
      </div>
      <div id="rag-results"></div>
    </div>

    <script>
      async function post(url, body) {
        const res = await fetch(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body) });
        if (!res.ok) throw new Error(await res.text());
        return res.json();
      }
      document.getElementById('chat-send').onclick = async () => {
        const prompt = document.getElementById('chat-input').value.trim();
        const out = document.getElementById('chat-output');
        out.textContent = '...';
        try {
          const data = await post('/api/chat', { prompt });
          out.textContent = data.text || JSON.stringify(data, null, 2);
        } catch (e) { out.textContent = 'Error: ' + e; }
      };
      document.getElementById('img-gen').onclick = async () => {
        const prompt = document.getElementById('img-prompt').value.trim();
        const out = document.getElementById('img-output');
        out.textContent = '...';
        try {
          const data = await post('/api/image/generate', { prompt });
          // Some providers return text with a URL; here we just display text
          out.innerHTML = '<pre>'+ (data.text || JSON.stringify(data, null, 2)) +'</pre>';
        } catch (e) { out.textContent = 'Error: ' + e; }
      };
      document.getElementById('ingest').onclick = async () => {
        const corpus = document.getElementById('corpus').value.trim();
        const file_path = document.getElementById('file-path').value.trim();
        const el = document.getElementById('rag-results');
        el.textContent = '...';
        try {
          const data = await post('/api/rag/ingest', { corpus, file_path });
          el.textContent = JSON.stringify(data, null, 2);
        } catch (e) { el.textContent = 'Error: ' + e; }
      };
      document.getElementById('search').onclick = async () => {
        const corpus = document.getElementById('corpus').value.trim();
        const query = document.getElementById('query').value.trim();
        const el = document.getElementById('rag-results');
        el.textContent = '...';
        try {
          const data = await post('/api/rag/search', { corpus, query, k: 5 });
          const html = (data.results || []).map(r => `<div class='item'><strong>${(r.score||0).toFixed(3)}</strong> â€” ${r.text}</div>`).join('');
          el.innerHTML = html || '<em>No results</em>';
        } catch (e) { el.textContent = 'Error: ' + e; }
      };
    </script>
  </body>
  </html>

